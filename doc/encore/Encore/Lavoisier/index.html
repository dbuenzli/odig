<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lavoisier (encore.Encore.Lavoisier)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v1.1.1-1774-g34216012"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">encore</a> &#x00BB; <a href="../index.html">Encore</a> &#x00BB; Lavoisier</nav><header class="odoc-preamble"><h1>Module <code><span>Encore.Lavoisier</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-state" class="anchored"><a href="#type-state" class="anchor"></a><code><span><span class="keyword">type</span> state</span><span> = </span></code><table><tr id="type-state.Partial" class="anchored"><td class="def variant constructor"><a href="#type-state.Partial" class="anchor"></a><code><span>| </span><span><span class="constructor">Partial</span> <span class="keyword">of</span> <a href="#type-partial">partial</a></span></code></td></tr><tr id="type-state.Done" class="anchored"><td class="def variant constructor"><a href="#type-state.Done" class="anchor"></a><code><span>| </span><span><span class="constructor">Done</span></span></code></td></tr><tr id="type-state.Fail" class="anchored"><td class="def variant constructor"><a href="#type-state.Fail" class="anchor"></a><code><span>| </span><span><span class="constructor">Fail</span></span></code></td></tr></table></div><div class="spec-doc"><p>Type of lavoisier's state.</p><p>The common way to use it is to fill a <code>Buffer</code>.t when we get the <code>Partial</code> case:</p><pre><code>let rec go = function
  | Partial { buffer; off; len; continue } -&gt;
      let str = Bigstringaf.substring buffer ~off ~len in
      Buffer.add_string buf str ;
      go (continue ~committed:len)
  | Done -&gt; Buffer.contents buf
  | Fail -&gt; failwith &quot;serialization&quot; in
go (emit v d)</code></pre></div></div><div class="odoc-spec"><div class="spec type" id="type-partial" class="anchored"><a href="#type-partial" class="anchor"></a><code><span><span class="keyword">and</span> partial</span><span> = </span><span>{</span></code><table><tr id="type-partial.buffer" class="anchored"><td class="def record field"><a href="#type-partial.buffer" class="anchor"></a><code><span>buffer : string;</span></code></td></tr><tr id="type-partial.off" class="anchored"><td class="def record field"><a href="#type-partial.off" class="anchor"></a><code><span>off : int;</span></code></td></tr><tr id="type-partial.len" class="anchored"><td class="def record field"><a href="#type-partial.len" class="anchor"></a><code><span>len : int;</span></code></td></tr><tr id="type-partial.continue" class="anchored"><td class="def record field"><a href="#type-partial.continue" class="anchor"></a><code><span>continue : <span>committed:int <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a>;</span></code></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>-'a t</span></span></code></div><div class="spec-doc"><p>A serializer for values of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-emit" class="anchored"><a href="#val-emit" class="anchor"></a><code><span><span class="keyword">val</span> emit : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-emit_string" class="anchored"><a href="#val-emit_string" class="anchor"></a><code><span><span class="keyword">val</span> emit_string : <span>?chunk:int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>emit_string ?chunk v t</code> runs <code>t</code> with <code>v</code>. The serializer allocates an internal buffer of <code>chunk</code> byte(s) (default to 4096 bytes) and enlarge it if it's needed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-char" class="anchored"><a href="#val-char" class="anchor"></a><code><span><span class="keyword">val</span> char : <span>char <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>char</code> accepts any character and emit it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string" class="anchored"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>string str</code> accepts <b>only</b> a string which is equal to <code>str</code> and emits it. Otherwise, it fails.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pure" class="anchored"><a href="#val-pure" class="anchor"></a><code><span><span class="keyword">val</span> pure : <span>compare:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>pure ~compare v</code> accepts <b>only</b> a value <code>'a</code> equal (see <code>compare</code>) to <code>v</code> and emits it. Otherwise, it fails.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-choose" class="anchored"><a href="#val-choose" class="anchor"></a><code><span><span class="keyword">val</span> choose : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>choose p q</code> runs <code>p</code> and emits it if succeeds. If <code>p</code> fails, then the output is reset and <code>q</code> will be run instead.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-put_while0" class="anchored"><a href="#val-put_while0" class="anchor"></a><code><span><span class="keyword">val</span> put_while0 : <span><span>(<span>char <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>put_while0 p</code> accepts a <code>string</code> which respects the predicate <code>p</code> and emits it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-put_while1" class="anchored"><a href="#val-put_while1" class="anchor"></a><code><span><span class="keyword">val</span> put_while1 : <span><span>(<span>char <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Same as <a href="#val-put_while1"><code>put_while1</code></a> but the given <code>string</code> must be not empty.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-put" class="anchored"><a href="#val-put" class="anchor"></a><code><span><span class="keyword">val</span> put : <span><span>(<span>char <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>put p n</code> accepts a <code>string</code> which respects the predicate <code>p</code> and must have <code>n</code> bytes. Then, it emits it otherwise it fails. For example, this ABNF:</p><pre>DIGIT := '0' .. '9'
NUMBER := 2DIGIT</pre><p>can be translated to:</p><pre><code>let number = put (function '0' .. '9' -&gt; true | _ -&gt; false) 2 </code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-at_least_put" class="anchored"><a href="#val-at_least_put" class="anchor"></a><code><span><span class="keyword">val</span> at_least_put : <span><span>(<span>char <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>at_least_put p n</code> accepts a <code>string</code> which respects the predicate <code>p</code> and must have, at least, <code>n</code> bytes. Then, it emits it otherwise it fails. For example, this ABNF:</p><pre>DIGIT := '0' .. '9'
NUMBER := 1*DIGIT</pre><p>can be translated to:</p><pre><code>let number = at_least_put (function '0' .. '9' -&gt; true | _ -&gt; false) 1</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-range" class="anchored"><a href="#val-range" class="anchor"></a><code><span><span class="keyword">val</span> range : <span>a:int <span class="arrow">&#45;&gt;</span></span> <span>b:int <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>char <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-(&lt;*)" class="anchored"><a href="#val-(&lt;*)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;*) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>unit <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-(*&gt;)" class="anchored"><a href="#val-(*&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (*&gt;) : <span><span>unit <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-product" class="anchored"><a href="#val-product" class="anchor"></a><code><span><span class="keyword">val</span> product : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fail" class="anchored"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-fix" class="anchored"><a href="#val-fix" class="anchor"></a><code><span><span class="keyword">val</span> fix : <span><span>(<span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-map" class="anchored"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-commit" class="anchored"><a href="#val-commit" class="anchor"></a><code><span><span class="keyword">val</span> commit : <span>unit <a href="#type-t">t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-peek" class="anchored"><a href="#val-peek" class="anchor"></a><code><span><span class="keyword">val</span> peek : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>,Â <span class="type-var">'b</span>)</span> <a href="../Either/index.html#type-t">Either.t</a></span> <a href="#type-t">t</a></span></span></code></div></div></div></body></html>